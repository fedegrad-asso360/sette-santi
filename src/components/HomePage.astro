---
import Layout from '../layouts/Layout.astro';
import MapComponent from '../components/MapComponent.astro';
import HeroCarousel from '../components/HeroCarousel.astro';
import StatsGrid from '../components/StatsGrid.astro';
import TrailCard from '../components/TrailCard.astro';
import SaintCard from '../components/SaintCard.astro';
import PricingCard from '../components/PricingCard.astro';
import { trailStages, getUniqueStartPoints } from '../data/trails';
import { saints } from '../data/saints';
import type { Language } from '../i18n';
import { useTranslations } from '../i18n';

export interface Props {
	lang: Language;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const stats = [
	{ value: trailStages.length, label: t('stats.stages') },
	{ value: '~81', label: t('stats.totalKm') },
	{ value: '5-7', label: t('stats.days') }
];

// Get unique starting points for the map
const startPoints = getUniqueStartPoints();
const mapMarkers = startPoints.map(point => ({
	name: point.name,
	coordinates: point.coordinates,
	description: 'Punto di partenza',
	type: 'start' as const
}));

// Highlight circle around San Ruffino
const highlightCircles = [
	{
		center: [43.0719, 13.2186] as [number, number],
		radius: 2000, // 2km radius
		color: '#d4af37',
		fillColor: '#d4af37',
		fillOpacity: 0.15,
		popup: '<b>San Ruffino di Amandola</b><br>Punto di partenza del cammino'
	}
];

const pricingOptions = [
	{
		icon: 'üéí',
		title: t('booking.individual.title'),
		description: t('booking.individual.description'),
		features: [
			{ text: 'GPS maps and tracks' },
			{ text: 'Recommended accommodations' },
			{ text: 'Phone support' }
		],
		price: t('booking.from') + ' ‚Ç¨299',
		highlighted: false
	},
	{
		icon: 'üë•',
		title: t('booking.group.title'),
		description: t('booking.group.description'),
		features: [
			{ text: 'Expert guide' },
			{ text: 'Luggage transport' },
			{ text: 'Meals included' },
			{ text: 'Accommodations booked' }
		],
		price: t('booking.from') + ' ‚Ç¨799',
		badge: t('booking.badge.popular'),
		highlighted: true
	},
	{
		icon: '‚≠ê',
		title: t('booking.premium.title'),
		description: t('booking.premium.description'),
		features: [
			{ text: 'Luxury accommodations' },
			{ text: 'Personal chef' },
			{ text: 'Private transfers' },
			{ text: 'Spiritual guide' }
		],
		price: t('booking.from') + ' ‚Ç¨1,499',
		highlighted: false
	}
];
---

<Layout title={t('hero.title')} description={t('hero.subtitle')}>
	<HeroCarousel />
	
	<section class="py-16 bg-white">
		<div class="container mx-auto px-4">
			<div class="grid md:grid-cols-2 gap-12 items-center">
				<div>
					<h2 class="text-4xl font-bold text-trail-green mb-6">
						{t('intro.title')}
					</h2>
					<p class="text-lg text-gray-700 mb-6 leading-relaxed">
						{t('intro.description1')}
					</p>
					<p class="text-lg text-gray-700 mb-8 leading-relaxed">
						{t('intro.description2')}
					</p>
					<StatsGrid stats={stats} columns={3} />
				</div>
				<div>
					<h3 class="text-2xl font-bold text-trail-brown mb-4">
						{t('whereWeAre.title')}
					</h3>
					<p class="text-gray-700 mb-4">
						{t('whereWeAre.description')}
					</p>
					<MapComponent 
						height="500px" 
						center={[43.0719, 13.2186]} 
						zoom={2} 
						markers={mapMarkers}
						showDirections={true}
						circles={highlightCircles}
					/>
					<div class="mt-4 bg-trail-sky bg-opacity-10 p-4 rounded-lg">
						<p class="text-sm text-gray-600">
							<strong>üí° {t('whereWeAre.tip')}:</strong> {t('whereWeAre.tipText')}
						</p>
						<div class="mt-3 space-y-2">
							{startPoints.map(point => (
								<div class="flex items-start">
									<span class="text-trail-green mr-2">üìç</span>
									<span class="text-gray-700 flex-1">{point.name}</span>
								</div>
							))}
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	
	<section id="trails" class="py-16 bg-gray-50">
		<div class="container mx-auto px-4">
			<div class="text-center mb-12">
				<h2 class="text-4xl font-bold text-trail-green mb-4">{t('trails.title')}</h2>
				<p class="text-xl text-gray-600 max-w-2xl mx-auto">
					{t('trails.subtitle')}
				</p>
			</div>
			
			<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
				{trailStages.map((stage) => (
					<TrailCard 
						id={stage.id}
						title={stage.title}
						subtitle={stage.subtitle}
						distance={stage.distance}
						duration={stage.duration}
						difficulty={stage.difficulty}
						slug={stage.slug}
						{...(stage.images[0]?.url ? { image: stage.images[0].url } : {})}
					/>
				))}
			</div>
		</div>
	</section>
	
	<section id="saints" class="py-16 bg-white">
		<div class="container mx-auto px-4">
			<div class="text-center mb-12">
				<h2 class="text-4xl font-bold text-trail-brown mb-4">{t('saints.title')}</h2>
				<p class="text-xl text-gray-600 max-w-2xl mx-auto">
					{t('saints.subtitle')}
				</p>
			</div>
			
			<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
				{saints.map((saint) => (
					<SaintCard 
						id={saint.id}
						name={saint.name}
						subtitle={saint.subtitle}
						description={saint.description}
						slug={saint.slug}
						festivity={saint.festivity}
						image={saint.images[0]}
					/>
				))}
			</div>

			<div class="text-center">
				<a 
					href="#saints" 
					class="inline-flex items-center px-8 py-3 bg-trail-brown text-white rounded-lg hover:bg-trail-gold transition-colors text-lg font-medium"
				>
					{t('saints.cta')}
					<svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
					</svg>
				</a>
			</div>
		</div>
	</section>
	
	<section id="booking" class="py-16 bg-trail-green text-white">
		<div class="container mx-auto px-4">
			<div class="text-center mb-12">
				<h2 class="text-4xl font-bold mb-4 text-trail-gold">{t('booking.title')}</h2>
				<p class="text-xl max-w-2xl mx-auto">
					{t('booking.subtitle')}
				</p>
			</div>
			
			<div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
				{pricingOptions.map(option => (
					<PricingCard 
						icon={option.icon}
						title={option.title}
						description={option.description}
						features={option.features}
						price={option.price}
						badge={option.badge}
						highlighted={option.highlighted}
					/>
				))}
			</div>
			
			<div class="text-center mt-12">
				<p class="mb-4">{t('booking.contact')}</p>
				<a href="mailto:info@settesanti.it" class="text-trail-gold hover:underline font-semibold">
					info@settesanti.it
				</a>
				<span class="mx-4">|</span>
				<a href="tel:+391234567890" class="text-trail-gold hover:underline font-semibold">
					+39 123 456 7890
				</a>
			</div>
		</div>
	</section>
</Layout>

---
import { getLangFromUrl, useTranslations } from '../i18n';

export interface Props {
  images?: string[];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { images = [
  'https://placehold.co/1920x800/5a8a6b/ffffff?text=Sentiero+dei+Sette+Santi',
  'https://placehold.co/1920x800/5e3b20/ffffff?text=Cammino+Spirituale',
  'https://placehold.co/1920x800/87a8c3/ffffff?text=Fede+e+Natura',
  'https://placehold.co/1920x800/d4af37/ffffff?text=Percorso+Italiano',
] } = Astro.props;
---

<div class="hero-carousel relative w-full h-[600px] md:h-[700px] overflow-hidden">
  <div class="carousel-track flex transition-transform duration-700 ease-in-out h-full">
    {images.map((image, index) => (
      <div class="carousel-slide min-w-full h-full relative">
        <img 
          src={image} 
          alt={`${t('hero.title')} ${index + 1}`}
          class="w-full h-full object-cover"
        />
        <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/20 to-black/60"></div>
      </div>
    ))}
  </div>

  <!-- Content Overlay -->
  <div class="absolute inset-0 flex flex-col items-center justify-center text-white text-center px-4 z-10">
    <h1 class="text-5xl md:text-6xl font-bold mb-6 text-trail-gold drop-shadow-lg">
      {t('hero.title')}
    </h1>
    <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto leading-relaxed drop-shadow-md">
      {t('hero.subtitle')}
    </p>
    <div class="flex flex-col md:flex-row gap-4 justify-center items-center">
      <a href="#trails" class="bg-trail-gold text-trail-brown px-8 py-4 rounded-lg font-semibold hover:bg-yellow-400 transition-colors shadow-lg">
        {t('hero.cta.discover')}
      </a>
      <a href="#booking" class="border-2 border-white px-8 py-4 rounded-lg font-semibold hover:bg-white hover:text-trail-green transition-colors shadow-lg">
        {t('hero.cta.book')}
      </a>
    </div>
  </div>

  <!-- Navigation Buttons -->
  <button 
    class="carousel-prev absolute left-4 top-1/2 -translate-y-1/2 bg-white/30 hover:bg-white/50 text-white p-3 rounded-full backdrop-blur-sm transition-all z-20"
    aria-label={t('common.readMore')}
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
  </button>
  
  <button 
    class="carousel-next absolute right-4 top-1/2 -translate-y-1/2 bg-white/30 hover:bg-white/50 text-white p-3 rounded-full backdrop-blur-sm transition-all z-20"
    aria-label="Immagine successiva"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
    </svg>
  </button>

  <!-- Indicators -->
  <div class="carousel-indicators absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-20">
    {images.map((_, index) => (
      <button 
        class="indicator w-3 h-3 rounded-full bg-white/50 hover:bg-white/80 transition-all"
        data-index={index}
        aria-label={`Vai all'immagine ${index + 1}`}
      ></button>
    ))}
  </div>
</div>

<script>
  const carousel = document.querySelector('.hero-carousel');
  if (carousel) {
    const track = carousel.querySelector('.carousel-track') as HTMLElement;
    const prevBtn = carousel.querySelector('.carousel-prev') as HTMLButtonElement;
    const nextBtn = carousel.querySelector('.carousel-next') as HTMLButtonElement;
    const indicators = carousel.querySelectorAll('.indicator');
    const slides = carousel.querySelectorAll('.carousel-slide');
    
    let currentIndex = 0;
    const totalSlides = slides.length;
    let autoplayInterval: number;

    const updateCarousel = (index: number) => {
      currentIndex = (index + totalSlides) % totalSlides;
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
      
      // Update indicators
      indicators.forEach((indicator, i) => {
        if (i === currentIndex) {
          indicator.classList.add('bg-white', 'w-8');
          indicator.classList.remove('bg-white/50', 'w-3');
        } else {
          indicator.classList.add('bg-white/50', 'w-3');
          indicator.classList.remove('bg-white', 'w-8');
        }
      });
    };

    const nextSlide = () => {
      updateCarousel(currentIndex + 1);
    };

    const prevSlide = () => {
      updateCarousel(currentIndex - 1);
    };

    const startAutoplay = () => {
      autoplayInterval = window.setInterval(nextSlide, 5000);
    };

    const stopAutoplay = () => {
      clearInterval(autoplayInterval);
    };

    // Event listeners
    prevBtn?.addEventListener('click', () => {
      prevSlide();
      stopAutoplay();
      startAutoplay();
    });

    nextBtn?.addEventListener('click', () => {
      nextSlide();
      stopAutoplay();
      startAutoplay();
    });

    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        updateCarousel(index);
        stopAutoplay();
        startAutoplay();
      });
    });

    // Pause on hover
    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prevSlide();
      if (e.key === 'ArrowRight') nextSlide();
    });

    // Initialize
    updateCarousel(0);
    startAutoplay();
  }
</script>

<style>
  .carousel-track {
    will-change: transform;
  }

  .indicator {
    transition: all 0.3s ease;
  }
</style>

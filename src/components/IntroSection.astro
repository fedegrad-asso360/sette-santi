---
import StatsGrid from './StatsGrid.astro';
import MapComponent from './MapComponent.astro';
import type { Language } from '../i18n';
import { useTranslations } from '../i18n';
import { trailStages, getUniqueStartPoints } from '../data/trails';

export interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const stats = [
  { value: trailStages.length, label: t('stats.stages') },
  { value: '~81', label: t('stats.totalKm') },
  { value: '5-7', label: t('stats.days') }
];

// Get unique starting points for the map
const startPoints = getUniqueStartPoints();
// Show only San Ruffino marker on home map
const mapMarkers = startPoints
  .filter(point => point.name === 'San Ruffino (Amandola)')
  .map(point => ({
    name: point.name,
    coordinates: point.coordinates,
    description: 'Punto di partenza del cammino',
    type: 'start' as const
  }));

// Highlight circle around San Ruffino
const highlightCircles = [
  {
    center: [43.0719, 13.2186] as [number, number],
    radius: 2000,
    color: '#d4af37',
    fillColor: '#d4af37',
    fillOpacity: 0.15,
    popup: '<b>San Ruffino di Amandola</b><br>Punto di partenza del cammino'
  }
];
---

<section class="py-16 bg-white">
  <div class="container mx-auto px-4">
    <div class="grid md:grid-cols-2 gap-12 items-center">
      <div>
        <h2 class="text-4xl font-bold text-trail-green mb-6">
          {t('intro.title')}
        </h2>
        <p class="text-lg text-gray-700 mb-6 leading-relaxed">
          {t('intro.description1')}
        </p>
        <p class="text-lg text-gray-700 mb-8 leading-relaxed">
          {t('intro.description2')}
        </p>
        <StatsGrid stats={stats} columns={3} />
      </div>
      <div>
        <h3 class="text-2xl font-bold text-trail-brown mb-4">
          {t('whereWeAre.title')}
        </h3>
        <p class="text-gray-700 mb-4">
          {t('whereWeAre.description')}
        </p>
        <MapComponent 
          height="500px" 
          center={[43.0719, 13.2186]} 
          zoom={6} 
          markers={mapMarkers}
          showDirections={true}
          circles={highlightCircles}
        />
        <div class="mt-4 bg-trail-sky bg-opacity-10 p-4 rounded-lg">
          <p class="text-sm text-gray-600">
            <strong>üí° {t('whereWeAre.tip')}:</strong> {t('whereWeAre.tipText')}
          </p>
          <div class="mt-3 space-y-2">
            {startPoints.map(point => (
              <div class="flex items-start">
                <span class="text-trail-green mr-2">üìç</span>
                <span class="text-gray-700 flex-1">{point.name}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
